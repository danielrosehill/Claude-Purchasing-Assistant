# Generate Recommendation

Produce the final purchasing recommendation as a **PDF report** using Typst.

## Prerequisites

Before generating a recommendation, verify:
1. `buyer-profile.md` has been reviewed
2. `purchases/active/[purchase]/requirements.md` exists
3. `from-ai/[purchase]/research.md` has been completed
4. At least one product has CONSIDER status

If prerequisites aren't met, inform the user what's missing and offer to help complete those steps.

## Recommendation Process

### 1. Review Considered Products

From the research, examine all products marked CONSIDER:
- Re-evaluate against buyer profile priorities
- Compare value-for-money across candidates
- Consider total cost of ownership
- Factor in intangibles (support quality, upgrade path, ecosystem)

### 2. Apply Weighted Criteria

Reference the priority order from `buyer-profile.md`. Default weights if not specified:

**Typically High Weight**
- Build quality/durability
- Manufacturer reputation
- Reliability track record

**Typically Medium Weight**
- Feature match to requirements
- Value vs. RRP
- Local support availability

**Typically Lower Weight**
- Cutting-edge features
- Aesthetics
- Brand prestige

Adjust based on the specific buyer profile priorities.

### 3. Rank Top 3 Choices

Select the top 3 products ranked by overall fit:
1. **#1 RECOMMENDED** — The clear best choice
2. **#2 Runner-up** — Strong alternative
3. **#3 Budget/Alternative** — For specific tradeoffs

Be decisive—the user wants a clear answer with a definitive #1 pick.

## Output: PDF Report

Generate a Typst document and compile to PDF.

### Step 1: Create Typst Source

Create `from-ai/[purchase-name]/report.typ`:

```typst
#set document(title: "[Product Category] Recommendation", author: "Claude Purchasing Assistant")
#set page(paper: "a4", margin: 2cm)
#set text(font: "Linux Libertine", size: 11pt)

= [Product Category] Recommendation Report

*Generated*: [Date] #h(1fr) *Budget*: [Amount] #h(1fr) *Location*: [Country]

#line(length: 100%)

== Executive Summary

[2-3 paragraph summary: what was evaluated, what the recommendation is, and why. Be decisive.]

#pagebreak()

== Top Recommendations

=== \#1: [Product Name] — #text(fill: green)[RECOMMENDED]

#table(
  columns: (1fr, 2fr),
  inset: 8pt,
  [*Price*], [[Amount] at [Store]],
  [*Key Specs*], [[Most relevant specifications]],
  [*Rating*], [[X.X/5 from N sources]],
  [*Recommendation Reason*], [[Why this is the top pick]],
)

==== Why This Product

[Detailed explanation of why this is the #1 choice, referencing user requirements]

---

=== \#2: [Product Name] — Runner-up

#table(
  columns: (1fr, 2fr),
  inset: 8pt,
  [*Price*], [[Amount] at [Store]],
  [*Key Specs*], [[Specifications]],
  [*Rating*], [[X.X/5]],
  [*Why \#2*], [[What makes it second choice]],
)

---

=== \#3: [Product Name] — [Budget Alternative / Niche Pick]

#table(
  columns: (1fr, 2fr),
  inset: 8pt,
  [*Price*], [[Amount] at [Store]],
  [*Key Specs*], [[Specifications]],
  [*Rating*], [[X.X/5]],
  [*When to Choose*], [[Specific scenario where this beats \#1]],
)

#pagebreak()

== Requirements Adherence

How each product meets your stated requirements:

#table(
  columns: (auto, auto, auto, auto),
  inset: 8pt,
  fill: (x, y) => if y == 0 { luma(230) },
  [*Requirement*], [*\#1*], [*\#2*], [*\#3*],
  [Must-have Feature A], [✓], [✓], [Partial],
  [Must-have Feature B], [✓], [✗], [✓],
  [Nice-to-have C], [✓], [✓], [✗],
  // Add all requirements from requirements.md
)

== Products Evaluated but Not Recommended

#table(
  columns: (1fr, 2fr),
  inset: 8pt,
  fill: (x, y) => if y == 0 { luma(230) },
  [*Product*], [*Reason Not Recommended*],
  [[Product Name]], [[Brief reason: price, specs, quality, etc.]],
  [[Product Name]], [[Brief reason]],
)

== Purchase Links

- *\#1 [Product Name]*: [Full URL]
- *\#2 [Product Name]*: [Full URL]
- *\#3 [Product Name]*: [Full URL]

#line(length: 100%)

== Methodology

*Sources checked*: [List sources]

*Data freshness*: Pricing verified [Date]

*Assumptions*: [Any assumptions made]

#v(1fr)

#align(center)[
  #text(size: 9pt, fill: luma(120))[
    Generated by Claude Purchasing Assistant
  ]
]
```

### Step 2: Compile to PDF

```bash
cd from-ai/[purchase-name]
typst compile report.typ report.pdf
```

### Step 3: Email Delivery (If Configured)

If Resend MCP is available and `buyer-profile.md` has an email:

1. Use Resend to send email:
   - **To**: Email from buyer profile
   - **Subject**: "[Product Category] Recommendation Ready"
   - **Body**:
     ```
     Your purchasing recommendation is ready.

     Top Pick: [Product Name] at [Price]

     The full report is attached. Key highlights:
     - [Reason 1]
     - [Reason 2]
     - [Reason 3]

     Purchase link: [URL]
     ```
   - **Attachment**: report.pdf

2. Confirm to user: "Report sent to [email]"

## Also Save Markdown Version

For convenience, also save `recommendation.md` with the same content in markdown format for Git tracking.

## Communication Style

Be confident and clear:
- "My recommendation is X" not "You might consider X"
- "This is the best value" not "This could be a good option"
- Own the recommendation—that's what the user is here for

## After Recommendation

Offer next steps:
- "Ready to purchase? The report and links are ready."
- "Want me to search for better pricing or monitor for sales?"
- "Should I archive this to completed purchases?"

When the user confirms purchase:
1. Move folder from `purchases/active/` to `purchases/completed/`
2. Add a completion note with actual purchase price and date
